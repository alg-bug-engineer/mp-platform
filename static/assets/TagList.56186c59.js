import{h as M,_ as V,d as P,r as E,k as L,p as W,e as I,c as u,w as t,M as c,j as s,o as p,u as O,I as q,m as n,q as G,l as B,t as A,f as H,s as J}from"./index.8fcb9160.js";import{l as K,d as Q}from"./tagManagement.88f4d544.js";const X=()=>M.get("/wx/export/tags",{params:{limit:1e3,offset:0},responseType:"blob"}),Y=x=>M.post("/wx/export/tags/import",x,{headers:{"Content-Type":"multipart/form-data"}});const Z={class:"tag-list"},ee={key:0,class:"load-more"},te={class:"total-count"},ue=P({__name:"TagList",setup(x){const y=E(!1),k=E(!1),v=E([]),l=E({current:1,pageSize:10,total:0}),D=E(window.innerWidth<768),T=()=>{D.value=window.innerWidth<768};L(()=>{window.addEventListener("resize",T)}),W(()=>{window.removeEventListener("resize",T)});const C=async(a=!1)=>{try{a?k.value=!0:y.value=!0;const e=await K({offset:(l.value.current-1)*l.value.pageSize,limit:l.value.pageSize});console.log(e),a?v.value=[...v.value,...e.list||[]]:v.value=e.list||[],l.value.total=e.total||0}catch{c.error("\u83B7\u53D6\u6807\u7B7E\u5217\u8868\u5931\u8D25")}finally{a?k.value=!1:y.value=!1}},z=async a=>{try{await Q(a),c.success("\u5220\u9664\u6210\u529F"),C()}catch{c.error("\u5220\u9664\u5931\u8D25")}},R=async()=>{var a;c.info("\u6B63\u5728\u751F\u6210\u5BFC\u51FA\u6587\u4EF6\uFF0C\u8BF7\u7A0D\u5019...");try{const e=await X(),o=(a=e.data)!=null?a:e,f=o instanceof Blob?o:new Blob([o],{type:"text/csv;charset=utf-8"}),_=window.URL.createObjectURL(f),d=document.createElement("a");d.href=_,d.download="\u6807\u7B7E\u5217\u8868.csv",document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(_),document.body.removeChild(d),c.success("\u6587\u4EF6\u5BFC\u51FA\u6210\u529F\uFF01")}catch(e){console.error("\u5BFC\u51FA\u6807\u7B7E\u5931\u8D25:",e);const o=(e==null?void 0:e.message)||"\u5BFC\u51FA\u6807\u7B7E\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u6216\u8054\u7CFB\u7BA1\u7406\u5458";c.error(o)}},S=async()=>{try{const a=document.createElement("input");a.type="file",a.accept=".csv",a.onchange=async e=>{var _,d,m,F;const o=(_=e.target.files)==null?void 0:_[0];if(!o)return;const f=new FormData;f.append("file",o),c.info("\u6B63\u5728\u5BFC\u5165\u6587\u4EF6\uFF0C\u8BF7\u7A0D\u5019...");try{const g=await Y(f),i=(d=g.data)!=null?d:g;c.success((i==null?void 0:i.message)||"\u5BFC\u5165\u6210\u529F"),C()}catch(g){const i=(F=(m=g.response)==null?void 0:m.data)==null?void 0:F.detail,w=typeof i=="object"&&i.message?i.message:i||"\u5BFC\u5165\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u6587\u4EF6\u683C\u5F0F\u6216\u8054\u7CFB\u7BA1\u7406\u5458";c.error(w),console.error("\u5BFC\u5165\u6807\u7B7E\u65F6\u53D1\u751F\u9519\u8BEF:",g)}},a.click()}catch(a){c.error((a==null?void 0:a.message)||"\u65E0\u6CD5\u6253\u5F00\u6587\u4EF6\u9009\u62E9\u5668")}},$=a=>{l.value.current=a,C()};return L(()=>{C()}),(a,e)=>{const o=s("a-button"),f=s("icon-plus"),_=s("a-space"),d=s("a-page-header"),m=s("a-table-column"),F=s("a-tag"),g=s("a-link"),i=s("a-popconfirm"),w=s("a-table"),U=s("a-list-item-meta"),h=s("a-list-item"),j=s("a-list"),N=s("a-card");return p(),I("div",Z,[u(d,{title:"\u6807\u7B7E\u7BA1\u7406",subtitle:"\u7BA1\u7406\u6587\u7AE0\u6807\u7B7E"},{extra:t(()=>[u(_,null,{default:t(()=>[u(o,{onClick:R},{icon:t(()=>[u(O(q))]),default:t(()=>[e[2]||(e[2]=n(" \u5BFC\u51FA\u6807\u7B7E "))]),_:1,__:[2]}),u(o,{onClick:S},{icon:t(()=>[u(O(G))]),default:t(()=>[e[3]||(e[3]=n(" \u5BFC\u5165\u6807\u7B7E "))]),_:1,__:[3]}),u(o,{type:"primary",onClick:e[0]||(e[0]=r=>a.$router.push("/tags/add"))},{icon:t(()=>[u(f)]),default:t(()=>[e[4]||(e[4]=n(" \u6DFB\u52A0\u6807\u7B7E "))]),_:1,__:[4]})]),_:1})]),_:1}),u(N,null,{default:t(()=>[D.value?(p(),B(j,{key:1,loading:y.value,"loading-more":k.value,data:v.value,pagination:l.value,onPageChange:$},{item:t(({item:r})=>[u(h,null,{default:t(()=>[u(U,null,{title:t(()=>[n(A(r.name)+" ",1),r.status===1?(p(),B(F,{key:0,color:"green",size:"small"},{default:t(()=>e[10]||(e[10]=[n("\u542F\u7528")])),_:1,__:[10]})):(p(),B(F,{key:1,color:"red",size:"small"},{default:t(()=>e[11]||(e[11]=[n("\u7981\u7528")])),_:1,__:[11]}))]),description:t(()=>[n(" \u521B\u5EFA\u65F6\u95F4: "+A(r.created_at),1)]),_:2},1024),u(_,null,{default:t(()=>[u(o,{type:"text",size:"small",onClick:b=>a.$router.push(`/tags/edit/${r.id}`)},{default:t(()=>e[12]||(e[12]=[n(" \u7F16\u8F91 ")])),_:2,__:[12]},1032,["onClick"]),u(i,{content:"\u786E\u8BA4\u5220\u9664\u8BE5\u6807\u7B7E\uFF1F",onOk:b=>z(r.id)},{default:t(()=>[u(o,{type:"text",status:"danger",size:"small"},{default:t(()=>e[13]||(e[13]=[n("\u5220\u9664")])),_:1,__:[13]})]),_:2},1032,["onOk"])]),_:2},1024)]),_:2},1024)]),footer:t(()=>[l.value.current*l.value.pageSize<l.value.total?(p(),I("div",ee,[u(o,{type:"primary",loading:k.value,onClick:e[1]||(e[1]=()=>{l.value.current++,C(!0)})},{default:t(()=>e[14]||(e[14]=[n(" \u52A0\u8F7D\u66F4\u591A ")])),_:1,__:[14]},8,["loading"]),H("div",te," \u5171 "+A(l.value.total)+" \u6761 ",1)])):J("",!0)]),_:1},8,["loading","loading-more","data","pagination"])):(p(),B(w,{key:0,loading:y.value,data:v.value,pagination:l.value,onPageChange:$},{columns:t(()=>[u(m,{title:"\u6807\u7B7E\u540D\u79F0","data-index":"name"}),u(m,{title:"\u72B6\u6001","data-index":"status"},{cell:t(({record:r})=>[r.status===1?(p(),B(F,{key:0,color:"green"},{default:t(()=>e[5]||(e[5]=[n("\u542F\u7528")])),_:1,__:[5]})):(p(),B(F,{key:1,color:"red"},{default:t(()=>e[6]||(e[6]=[n("\u7981\u7528")])),_:1,__:[6]}))]),_:1}),u(m,{title:"\u521B\u5EFA\u65F6\u95F4","data-index":"created_at"}),u(m,{title:"\u64CD\u4F5C"},{cell:t(({record:r})=>[u(_,null,{default:t(()=>[u(g,{type:"primary",target:"_blank",href:`/feed/tag/${r.id}.rss`},{default:t(()=>e[7]||(e[7]=[n(" \u8BA2\u9605 ")])),_:2,__:[7]},1032,["href"]),u(o,{type:"text",onClick:b=>a.$router.push(`/tags/edit/${r.id}`)},{default:t(()=>e[8]||(e[8]=[n(" \u7F16\u8F91 ")])),_:2,__:[8]},1032,["onClick"]),u(i,{content:"\u786E\u8BA4\u5220\u9664\u8BE5\u6807\u7B7E\uFF1F",onOk:b=>z(r.id)},{default:t(()=>[u(o,{type:"text",status:"danger"},{default:t(()=>e[9]||(e[9]=[n("\u5220\u9664")])),_:1,__:[9]})]),_:2},1032,["onOk"])]),_:2},1024)]),_:1})]),_:1},8,["loading","data","pagination"]))]),_:1})])}}});var ne=V(ue,[["__scopeId","data-v-85c15ed6"]]);export{ne as default};
